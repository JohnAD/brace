#!/lang/b
use b
Main()
	nl()
	let(firstname, sh("firstname"))
	Say("%s, if you like, you can enter some contact info.")
	Say("By default, this info is only visible to admins and your friends.")
	Say("If you don't wish to enter something, just press enter.")
	Say("To clear an existing value, type: -")
	nl()

_sh_b_f_v(buffer *b, const char *filename, char *const argv[])
	int fd[2]
	Pipe(fd)
	pid_t pid
	pid = Fork()
	if pid == 0
		Dup2(fd[1], 1)
		Close(fd[0])
		Execvp(filename, argv)
	Close(fd[1])
	int size
	Slurp(fd[0], b)
	buffer_squeeze(b)
	int status
	Waitpid(pid, &status, 0)
	if WIFEXITED(status)
		return WEXITSTATUS(status)
	return -1

cstr _sh_f_V(const char *filename, char *const argv[])
	new(b, buffer, 128)
	_sh_b_f_v(b, filename, argv)
	buffer_squeeze(b)
	return buffer_to_cstr(b)

def sh(b, filename, argv) _sh_b_f_v(b, filename, argv)
def sh(filename, argv) _sh_b_f(filename, argv)

def sh(filename, char *const argv[])

#sub say { print @_, "\n"; }
#
#say;
#say "`firstname`, if you like, you can enter some contact info.";
#say "By default, this info is only visible to admins and your friends.";
#say "If you don't wish to enter something, just press enter.";
#say "To clear an existing value, type: -";
#say;
#F="$HOME/.contact"
#[ -e "$F" ] && . "$F"
#
#rd() {
#	say -n "$1:"$'\t'
#	DOLLAR_VAR=`say "\\\$$1"`
#	OLD=$(eval say "$DOLLAR_VAR")
#	[ -n "$OLD" ] && say "[$OLD]"$'\t'
#	read NEW
#	case "$NEW" in
#	"") NEW="$OLD" ;;
#	"-") NEW="" ;;
#	esac
#	eval $(eval say "$DOLLAR_VAR")=\"\$NEW\"
#}
#
#rd Phone
#rd Country
#rd Town
#rd Postcode
#rd Address
#rd Jabber
#rd IRC
#rd ICQ
#rd YIM
#rd AIM
#rd MSN
#
#rm -f "$F"
#touch "$F"
#chmod 0600 "$F"
#
#cat <<End > "$F"
#Phone="$Phone"
#Country="$Country"
#Town="$Town"
#Postcode="$Postcode"
#Address="$Address"
#Jabber="$Jabber"
#IRC="$IRC"
#ICQ="$ICQ"
#YIM="$YIM"
#AIM="$AIM"
#MSN="$MSN"
#End
#
#chmod 0440 "$F"
#say
#say "Your contact info has been stored in the file $F"
#say 'You can change your contact info by running `setup_contact`.'
#say 'You can change your preferred email address by running `setup_email`.'
#say
#setup_contact_hooks
#say
